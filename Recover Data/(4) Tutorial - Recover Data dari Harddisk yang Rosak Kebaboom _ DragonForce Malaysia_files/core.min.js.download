!function(f,h,v,w){var b=navigator.userAgent;var u=/firefox/i.test(b);var p=/Edge/i.test(b);var a=!p&&/Chrome/i.test(b);var q=/Mobi|Android/i.test(b);var D=f("#siropuChat");var z=f("#siropuChatHeader");var F=f("#siropuChatTabs");var d=F.find('a[data-target="room-list"]');var j=F.find('a[data-target="conv-list"]');var k=F.find('a[data-target="conv-form"]');var y=f("#siropuChatContent");var G=f(".siropuChatMessages");var s=f("#siropuChatStartConversation");var t=f(".siropuChatConversation.siropuChatUsers");var l=f("#siropuChatNoConversations");var H=f("#siropuChatRooms");var E=f("#siropuChatSettings");var e=f("#siropuChatEditor");var c=e.find("form");var o=c.find('textarea[name="message_html"]');var n=c.find('button[type="submit"]');var B=f("#siropuChatBar");var A=f("#siropuChatBarMessageContainer");var r=f("#siropuChatBarUserCount span");var i=D.hasClass("siropuChatPage");var m=D.hasClass("siropuChatAllPages");var C=f(".siropuChatLogout");var g=f('a[data-nav-id="siropuChat"]');var x;XF.SiropuChat={};XF.SiropuChat.Core=XF.Element.newHandler({options:{active:false},userId:0,canUseChat:true,loggedIn:f("#XF").data("logged-in"),channel:"room",screenSize:"l",serverTime:0,pageFocus:true,pageTitle:f("title").text(),tabNotification:false,tabNotificationInterval:null,roomId:1,primaryRoomId:0,lastId:{},convId:0,convUnread:{},convOnly:0,convItems:[],guestRoom:0,noticeLastUpdate:0,userLastUpdate:0,convLastActive:0,convLastUpdate:0,userUpdateInterval:30,convUpdateInterval:60,messageDisplayLimit:25,notificationTimeout:5000,isVisible:D.is(":visible"),refreshActive:5000,refreshActiveHidden:15000,refreshInactive:30000,refreshInactiveHidden:60000,refreshInterval:0,refreshSet:null,inverse:0,floadCheck:0,roomFloodCheck:0,bypassFloodCheck:false,displayNavCount:false,forceRoom:false,inIframe:h.frameElement,dynamicTitle:true,activeUsers:{},commands:{},sounds:{},loadMoreButton:{room:true,conv:true},forceAutoScroll:false,joinCommand:null,loadRooms:false,internalLinksInNewTab:false,roomTabUserCount:true,enableRightNavLinkMobile:true,convTabCount:"onlineCount",userListOrder:"most_active",init:function(){var J=this;o.on("editor:init",function(M,L){x=L});this.getScreenSize();this.startRefreshInterval();this._initSubmitForm();this._initTabs();this._initRoomListActions();this._initRoomActions();this._initConversations();this._initAutoScrollToggle();this._initSounds();this._initOnLoad();E.on("change",f.proxy(this,"saveSettings"));B.on("click",f.proxy(this,"toggleChat"));D.on("new-message",f.proxy(this,"newMessage"));if(m&&XF.siropuChatNoFooterPadding===undefined){f(".p-footer").css("padding-bottom",60)}if(q){f('textarea[name="message_html"]').on("editor:init",function(L,M){M.events.on("focus",function(O){var N=f(L.target);if(N.parents("#siropuChat").length==0&&m){B.fadeOut()}});M.events.on("blur",function(O){var N=f(L.target);if(N.parents("#siropuChat").length==0&&m){B.fadeIn()}})});if(this.enableRightNavLinkMobile&&f(".p-nav-menuTrigger").is(":visible")&&g.length&&!f(".p-navgroup-link--chat").length){var K=parseInt(g.find(".badge").text());var I=f('<a href="'+g.attr("href")+'" class="p-navgroup-link p-navgroup-link--chat" aria-label="Chat" title="Chat"><i class="far fa-comments"></i></a>');if(K){I.addClass("badgeContainer badgeContainer--highlighted").attr("data-badge",K)}I.insertAfter(".p-navgroup-link--whatsnew")}}f(h).scroll(function(){if(f(".p-navSticky").length&&f(".siropuChatAllPages.siropuChatMaximized").length){J.adjustContentHeight()}});f(h).resize(function(){if(q){return}J.getScreenSize();J.adjustContentHeight();J.adjustInputBox();if(J.inRoom()){if(F.length){J.switchRoom(J.roomId,true)}else{if(!J.getMiscSetting("hide_chatters")){var L=f('.siropuChatRoom.siropuChatUsers[data-room-id="'+J.roomId+'"]');if(J.screenSizeIs("s")){L.hide()}else{L.show()}}}}else{J.switchConversation(J.convId)}});f(h).blur(function(){J.pageFocus=false});f(h).focus(function(){J.pageFocus=true;if(J.tabNotificationInterval){clearInterval(J.tabNotificationInterval);f("title").text(J.pageTitle)}});f(v).on("keyup",function(L){if(L.which==27&&m&&J.isVisible){J.toggleChat()}});f(v).on("click",".siropuChatMessageRow.siropuChatBot ol li b",function(){J.editorSetHtml(f(this).html())});f(v).on("siropuChat:show-load-more",".siropuChatMessages",function(){if(J.inRoom()&&!J.loadMoreButton.room||J.inConv()&&!J.loadMoreButton.conv){return}if(f(this).find("> li[data-id]").length<J.messageDisplayLimit){return}var M=f('<li class="siropuChatLoadMoreMessages" style="display: none;" />');var L=f('<a class="button button--link" data-xf-click="siropu-chat-load-more-messages" />');L.html(XF.phrase("siropu_chat_load_more_messages")).appendTo(M);if(f(this).find(".siropuChatLoadMoreMessages").length){return f(this).find(".siropuChatLoadMoreMessages").fadeIn()}if(J.inverse){M.appendTo(f(this)).fadeIn();f(this).scrollTop(1000000)}else{M.prependTo(f(this)).fadeIn()}XF.activate(M)});f(v).on("click",function(L){if(m&&J.isVisible&&L.target.className.match("p-")){B.trigger("click")}});this.$target.on("mouseover mouseout",".siropuChatMessageRow",function(M){var N=f(this).find(".siropuChatMessageActions");var L=f(this).find(".siropuChatDateTime");if(N.length){if(M.type=="mouseover"){N.show();L.hide()}else{N.hide();L.show()}}});f(v).on("click",".siropuChatMessageText .link--internal",function(L){if(J.internalLinksInNewTab){L.preventDefault();h.open(f(this).attr("href"),"_blank")}});f("#siropuChatBarDisable").on("click",function(){f(this).find("i").removeClass("fa-toggle-off").addClass("fa-toggle-on");setTimeout(function(){E.find('input[name="disable"]').trigger("click")},1000)});setTimeout(function(){if(J.inRoom()&&J.loadRooms&&!J.getRoomCount()){d.click()}else{if(J.inConv()&&J.getConvCount()){t.find(".siropuChatActiveConversation").trigger("click",true)}}if(J.hasUnreadConversations()){J.addBarNewMessageClass()}},500);if(this.inRoom()&&this.isResponsive()){f(".siropuChatRoom.siropuChatUsers").hide()}if(this.inConv()){this.orderConversations()}this.joinCommand=this.getCommand("join");this.noticeLastUpdate=this.serverTime;this.userLastUpdate=this.serverTime;this.convLastUpdate=this.serverTime;this.convLastActive=this.serverTime;this.autoScroll();this.toggleLogout();this.toggleBotMessages()},getScreenSize:function(){if(h.matchMedia("(max-width: 768px)").matches){this.screenSize="s"}else{if(h.matchMedia("(max-width: 1024px)").matches){this.screenSize="m"}else{this.screenSize="l"}}},getRoomCount:function(){return D.find(".siropuChatMessages[data-room-id]").length},getConvCount:function(){return D.find("li[data-conv-id]").length},screenSizeIs:function(I){return this.screenSize==I},isResponsive:function(){return(this.screenSizeIs("s")||D.hasClass("siropuChatSidebar"))},newMessage:function(J,I){if(!this.pageFocus&&I.isSelf){return}if(I.action!="join"){this.playSound(I);if(!this.pageFocus){this.displayTabNotification(I);this.initDesktopNotification(I)}}},doMessageActions:function(O){if(!O.actions){return}for(var J in O.actions){var M=O.actions[J];for(var T in M){if(J=="rooms"&&this.lastId[T]===undefined){continue}if(J=="rooms"){var I=f('.siropuChatMessages[data-room-id="'+T+'"]')}else{var I=f('.siropuChatMessages[data-conv-id="'+T+'"]')}for(var R in M[T]){var L=M[T][R];var U=I.find('> li[data-id="'+R+'"]');for(var S in L.action){if(U.attr("data-last-change")==L.action[S]){continue}switch(S){case"edit":U.find(".siropuChatMessageText").html(L.html);break;case"delete":U.fadeOut();break;case"like":var K=U.find(".siropuChatMessageLikes");if(K.length){if(L.likes){K.replaceWith(L.likes)}else{K.remove()}}else{U.find(".siropuChatMessageText").after(L.likes)}break;case"react":var Q=U.find(".siropuChatReactions");var P=f(L.reactions);if(P){P.find(".siropuChatReactionView").replaceWith(XF.phrase("view"))}if(Q.length){if(P){Q.html(P)}else{Q.remove()}}else{U.find(".siropuChatMessageText").after(P)}break;case"prune":if(L.prune){if(f.isNumeric(L.prune)){I.find('> li[data-user-id="'+L.prune+'"]').remove()}else{for(var N in L.prune){I.find('> li[data-id="'+L.prune[N]+'"]').remove()}}}else{I.find("> li").each(function(){if(f(this).data("id")<R){f(this).remove()}})}break}U.attr("data-last-change",L.action[S])}}}}},updateHeaderTitle:function(I){if(this.dynamicTitle){z.find("> span").text(I.data("title"))}},updateRooms:function(ab){var T=this;var Z=false;var aa=false;if(ab.rooms===undefined){return}for(var I in ab.rooms){var O=y.find('.siropuChatRoom.siropuChatMessages[data-room-id="'+I+'"]');var L=y.find('.siropuChatRoom.siropuChatUsers[data-room-id="'+I+'"]');var X=f(ab.rooms[I]["messages"]);var S=ab.rooms[I]["users"];var M=ab.rooms[I]["userCount"];var Y=F.find('a[data-room-id="'+I+'"]');var W=L.find(".siropuChatNoRoomUsers");if(this.activeUsers[I]===undefined){this.activeUsers[I]=[]}var V=false;if(ab.inactiveRoomId!==undefined||ab.action!="submit"&&(ab.action=="join"||ab.updateUsers)){if(M){for(var K in S){var P=S[K];var J=P.activity;var U=P.status;var Q=P.html;if(K){var ac=L.find('> li[data-user-id="'+K+'"]')}else{var ac=L.find('li[data-username="'+P.username+'"]')}if(Q){if(ac.length){if(K==0){ac.find(".siropuChatActivityStatus").attr("data-status",J)}continue}if(W.length){L.html(Q)}else{L.prepend(Q)}if(K&&f.inArray(K,this.activeUsers[I])==-1){this.activeUsers[I].push(K);V=true}XF.activate(L)}else{if(ac.length){if(J=="inactive"){ac.remove();this.removeUserFromActiveUsers(I,K)}else{this.updateUser(ac,J,U)}}}}if(this.userListOrder=="most_active"){V=true}}else{this.activeUsers[I]=[];this.addNoRoomUsersMessage(L)}if(this.roomTabUserCount){Y.find("span").html(M).attr("class","siropuChatTabCount"+(M?"Active":"Inactive"))}aa=true}if(X.length){X=f.grep(X,function(ad){return O.find('> li[data-id="'+f(ad).data("id")+'"]').length?false:true});if(this.inverse){O.prepend(X)}else{O.append(X)}this.delayAutoscroll(ab,O);this.deleteOlderMessages(ab.serverTime,O);if(!Y.hasClass("siropuChatActiveTab")){Y.addClass("siropuChatNewMessage")}if(f(X).length){Z=true}XF.activate(f(".siropuChatRoom.siropuChatMessages > li"))}if(V){var R=L.find("> li").detach();switch(this.userListOrder){case"most_active":var N=R.sort(function(ae,ad){return f(ae).data("last-active")-f(ad).data("last-active")});break;case"alphabetically":var N=R.sort(function(ae,ad){return String.prototype.localeCompare.call(f(ae).data("username").toLowerCase(),f(ad).data("username").toLowerCase())});break}L.html(N)}}if(aa){this.userLastUpdate=ab.serverTime;this.updateNavUserCount(ab)}this.updateLastId(ab);this.updateRoomTabs(ab);this.updateBar(ab,aa);if(Z){ab.channel="room";D.trigger("new-message",ab)}},updateConversations:function(N){var S=this;var P=false;this.convUnread={};if(N.convContacts&&(N.action=="start"||N.updateConv)){if(this.convTabCount!="disabled"){j.find("span").html(N.convTabCount).attr("class","siropuChatTabCount"+(N.convTabCount?"Active":"Inactive"))}if(N.convItems!==undefined){this.convItems=N.convItems}for(var R in N.convContacts){var K=N.convContacts[R]["activity"];var L=N.convContacts[R]["status"];var O=N.convContacts[R]["html"];if(O){t.prepend(O);if(l.length){l.remove()}if(f.inArray(R,this.convItems)==-1){this.convItems.push(R)}}else{var Q=t.find('> li[data-conv-id="'+R+'"]');if(Q.length){this.updateUser(Q,K,L)}}}this.convLastUpdate=N.serverTime}if(N.convMessages){for(var J in N.convMessages){var M=f(N.convMessages[J]);var I=f('.siropuChatConversation.siropuChatMessages[data-conv-id="'+J+'"]');if(I.length){M=f.grep(M,function(T){return I.find('> li[data-id="'+f(T).data("id")+'"]').length?false:true})}else{if(!this.convId||N.convId){I=this.createConversationMessageContainer(J);I.insertBefore(s);this.convId=N.convId?N.convId:J;setTimeout(function(){t.find('li[data-conv-id="'+S.convId+'"]').click()})}}if(this.inverse){I.prepend(M)}else{I.append(M)}XF.activate(f(".siropuChatConversation.siropuChatMessages > li"));this.delayAutoscroll(N,I);this.deleteOlderMessages(N.serverTime,I)}}if(N.convUnread){this.convUnread=N.convUnread;for(var J in N.convUnread){var Q=t.find('li[data-conv-id="'+J+'"]');if(!Q.hasClass("siropuChatNewMessage")){P=true}Q.addClass("siropuChatNewMessage")}if(this.inRoom()){j.addClass("siropuChatNewMessage")}}if(P){N.channel="conv";D.trigger("new-message",N);this.addBarNewMessageClass();this.orderConversations()}},orderConversations:function(){if(t.find("li.siropuChatNewMessage").length){var J=t.find("> li").detach();var I=J.sort(function(L,K){return Number(f(K).hasClass("siropuChatNewMessage"))>Number(f(L).hasClass("siropuChatNewMessage"))?1:-1});t.html(I)}},hasUnreadConversations:function(){return !f.isEmptyObject(this.convUnread)},markCurrentConversationAsRead:function(){if(this.convUnread[this.convId]!==undefined){var I=this;XF.ajax("POST",XF.canonicalizeUrl("index.php?chat/conversation/"+this.convId+"/mark-as-read"),{conv_unread:this.convUnread[this.convId]},function(J){if(J.convRead){delete I.convUnread[J.convRead];setTimeout(function(){f(".siropuChatConversation:visible .siropuChatMessageRow").removeClass("siropuChatUnread")},5000)}},{skipDefault:true,global:false})}},createRoomMessageContainer:function(I){return f('<ul class="siropuChatRoom siropuChatMessages" data-room-id="'+I+'" data-autoscroll="1" />')},createConversationMessageContainer:function(I){return f('<ul class="siropuChatConversation siropuChatMessages" data-conv-id="'+I+'" data-autoscroll="1" />')},updateNotice:function(J){var K=f("#siropuChatNotice");if(J.notice&&(J.serverTime-this.noticeLastUpdate>=60||!K.length)){var I=f(J.notice);if(K.length&&K.find("span").text()==I.find("span").text()){return}I.find("span").hide();if(K.length){K.replaceWith(I)}else{z.after(I)}setTimeout(function(){I.find("span").fadeIn()});this.noticeLastUpdate=J.serverTime}if(!J.notice&&K.length){K.remove()}},updateUser:function(J,N,I){J.find(".siropuChatActivityStatus").attr("data-status",N);var M=J.find(".siropuChatUserStatus");var L=M.length;if(I){if(L){M.html(I)}else{var K=f('<div class="siropuChatUserStatus" />');K.html(I).appendTo(J)}}else{if(L){M.remove()}}},updateActivityStatus:function(I){if(I.action!="submit"&&this.options.active!=I.active){this.options.active=I.active;D.attr("data-active",I.active);this.resetRefreshInterval()}},updateNavUserCount:function(K){if(!this.displayNavCount){return}var I=g.find("span.badge");I.text(K.userCount);if(K.userCount){I.addClass("badge--active")}else{I.removeClass("badge--active")}var J=f(".p-navgroup-link--chat");if(J.length){if(K.userCount){J.addClass("badgeContainer badgeContainer--highlighted")}else{J.removeClass("badgeContainer badgeContainer--highlighted")}J.attr("data-badge",K.userCount)}},updateBar:function(I,J){if(!(I.lastRow&&m)){return}A.html(I.lastRow.message);B.attr("data-room-id",I.lastRow.roomId);if(I.action!="submit"&&!this.getMiscSetting("hide_chatters")&&J){r.html(I.userCount)}},updateRoomTabs:function(J){if(this.forceRoom==true||this.loggedIn==false||J.joinedRooms===undefined){return}if(F.length){if(this.lastId&&J.joinedRooms){for(var I in this.lastId){if(f.inArray(Number(I),J.joinedRooms)==-1){this.leaveRoomPostActions(I)}}}else{if(this.getRoomCount()){this.postLogout()}}}},updateLastId:function(I){if(I.lastId===undefined||I.lastId.length===0){return}for(var J in I.lastId){this.lastId[J]=I.lastId[J]}},getRooms:function(){XF.ajax("GET",XF.canonicalizeUrl("index.php?chat/room/list"),{},function(I){if(I.html){XF.setupHtmlInsert(I.html,function(J,K,L){H.html(J)})}})},loadRoom:function(K){var I=this;var J=f(K.roomTab);if(this.getRoomCount()==0){J.removeClass("siropuChatActiveTab")}J.insertBefore(d);var L=this.createRoomMessageContainer(K.roomId);L.prependTo(y);this._initAutoScrollToggle(L);f('<ul class="siropuChatRoom siropuChatUsers" data-room-id="'+K.roomId+'" />').prependTo(y);this.activeUsers[K.roomId]=K.userIds;this.updateRooms(K);setTimeout(function(){I.doAutoScroll(L)});this.switchRoom(K.roomId);this.toggleLogout()},leaveRoom:function(J){var I=this;var J=J?J:this.roomId;XF.ajax("POST",XF.canonicalizeUrl("index.php?chat/room/"+J+"/leave"),{},function(K){I.leaveRoomPostActions(J)},{skipDefault:true})},leaveRoomPostActions:function(K,I){var M=D.find('[data-room-id="'+K+'"]');var J=F.find('[data-room-id="'+K+'"]');if(J.data("leave")==false){return false}M.remove();delete this.lastId[K];delete this.activeUsers[K];XF.Cookie.remove("siropu_chat_room_id");if(I){var L=F.find("[data-room-id]:last");if(L.length){L.click()}else{d.click()}}this.toggleLogout()},leaveConversationPostActions:function(I){D.find('[data-conv-id="'+I.convId+'"]').remove();this.convItems.splice(f.inArray(I.convId,this.convItems),1);XF.Cookie.remove("siropu_chat_conv_id");if(this.getConvCount()){t.find("li[data-conv-id]:first").click()}else{if(I.noConversations!==undefined){t.html(I.noConversations);XF.activate(t)}}},autoScroll:function(I){var I=I?I:f(".siropuChatMessages");if(I.attr("data-autoscroll")==1||this.forceAutoScroll){this.doAutoScroll(I)}},doAutoScroll:function(I){var I=I?I:f(".siropuChatMessages");if(this.inverse){I.scrollTop(0)}else{I.scrollTop(1000000)}},delayAutoscroll:function(K,J){var I=this;if(K.hasImages){setTimeout(function(){I.autoScroll(J)},1000)}else{this.autoScroll(J)}},getSoundSetting:function(I){return E.find('input[name="sound['+I+']"]').is(":checked")},getNotificationSetting:function(I){return E.find('input[name="notification['+I+']"]').is(":checked")},getMiscSetting:function(I){return E.find('input[name="'+I+'"]').is(":checked")},getCommand:function(I){return this.commands[I]},getNotificationPhrase:function(J){var I=this.getMessageType(J);switch(I){case"mention":case"public":return XF.phrase("siropu_chat_new_public_message");break;case"private":return XF.phrase("siropu_chat_new_private_message");break;case"whisper":return XF.phrase("siropu_chat_new_whisper_message");break;default:return XF.phrase("siropu_chat_new_message");break}},getMessageType:function(I){return I.channel=="room"?I.lastRow.type:I.convLastRow.type},playSound:function(I){if(XF.isIOS()){return false}if(I.channel=="room"){var J=I.playSound}else{var J=I.convPlaySound}if(this.sounds[J]){this.sounds[J].play()}},initDesktopNotification:function(J){var I=this;if(!("Notification" in h)){return}if(!this.getNotificationSetting(this.getMessageType(J))){return}if(Notification.permission==="granted"){this.sendDesktopNotification(J)}else{if(Notification.permission!=="denied"){Notification.requestPermission(function(K){if(K==="granted"){I.sendDesktopNotification(J)}})}}},sendDesktopNotification:function(L){if(L.channel=="room"){var K=L.lastRow}else{var K=L.convLastRow}var I=this;var J={body:K.text,icon:K.avatar,tag:"siropuChatNotification"};var M=new Notification(this.getNotificationPhrase(L),J);setTimeout(M.close.bind(M),this.notificationTimeout);M.onclick=function(){this.close();h.focus();if(m&&I.isVisible){B.click()}else{I.switchRoom()}}},displayTabNotification:function(J){var I=this;if(this.tabNotification&&!this.tabNotificationInterval){this.tabNotificationInterval=setInterval(function(){f("title").text(f("title").text()==I.pageTitle?I.getNotificationPhrase(J):I.pageTitle)},1500)}},switchRoom:function(L,J){var K=F.find('a[data-room-id="'+L+'"]');var I=K.data("flood-check");this.roomFloodCheck=I?I:this.floodCheck;K.trigger("click",J)},switchConversation:function(I){t.find('li[data-conv-id="'+I+'"]').click()},preSubmit:function(){var I=this;if(XF.isEditorEnabled()){this.editorSetHtml("");this.editorOffPlaceholder("posting")}else{c.find('textarea[name="message"]').val("")}this.responseTimeout=setTimeout(function(){I.editorSetPlaceholder("noresponse");I.editorOn();I.startRefreshInterval()},5000);this.stopRefreshInterval()},postSubmit:function(){if(this.inRoom()&&!this.getRoomCount()||this.inConv()&&!this.getConvCount()){this.editorOffPlaceholder("")}else{this.editorOn();if(!q){this.editorFocus()}if(this.inRoom()){this.editorSetPlaceholder("public")}else{this.editorSetPlaceholder("private",t.find('li[data-conv-id="'+this.convId+'"]'))}}clearTimeout(this.responseTimeout);this.startRefreshInterval()},saveSettings:function(J){var I=this;if(!E.length){return}XF.ajax("POST",XF.canonicalizeUrl("index.php?chat/save-settings"),E.serialize(),function(L){if(L.errorHtml){XF.setupHtmlInsert(L.errorHtml,function(M,N){var O=N.h1||N.title||XF.phrase("oops_we_ran_into_some_problems");XF.overlayMessage(O,M)});return true}var K="";if(J!==undefined){K=J.target.name}switch(K){case"inverse":I.inverse=I.getMiscSetting("inverse");I.autoScroll();break;case"maximized":D.toggleClass("siropuChatMaximized");I.adjustContentHeight();if(m&&!D.hasClass("siropuChatMaximized")){D.css("z-index","");y.css("height","")}break;case"display_mode":case"editor_on_top":if(K=="display_mode"&&i){return}XF.flashMessage(XF.phrase("siropu_chat_settings_change_reload_page"),3000);break;case"hide_bot":I.toggleBotMessages();break;case"hide_chatters":D.toggleClass("siropuChatHideUserList");break;case"disable":f("#siropuChatBar").remove();E.parents(".menu").remove();XF.flashMessage(XF.phrase("siropu_chat_has_been_disabled"),5000);XF.setupHtmlInsert(L.html,function(M,N){D.replaceWith(M)});D.trigger("disabled");break;default:if(K.match("sound")){I._initSounds()}break}},{skipDefault:true})},toggleChat:function(I){if(I.target.className.match("fa-")){return}D.toggle();A.toggle();this.isVisible=D.is(":visible");if(this.inRoom()){this.switchRoom(B.attr("data-room-id"))}if(this.inConv()&&this.isVisible&&this.hasUnreadConversations()){this.markCurrentConversationAsRead()}B.removeClass("siropuChatNewMessage");this.doAutoScroll();this.resetRefreshInterval();this.adjustContentHeight();if(!this.screenSizeIs("s")){this.editorFocus()}D.trigger("toggle",this.isVisible)},toggleAutoScroll:function(I){var K=parseInt(I[0].scrollHeight-I.innerHeight());var J=parseInt(I.scrollTop());I.attr("data-autoscroll",0);if(((J==K||J+1==K||J-1==K)&&!this.inverse)||J==0&&this.inverse){I.attr("data-autoscroll",1)}if(J==0&&!this.inverse||((J==K||J+1==K||J-1==K)&&this.inverse)){I.trigger("siropuChat:show-load-more")}},toggleLogout:function(){if(!C.length){return}var I=this.getRoomCount();var J=D.find('a[data-leave="false"]').length;if(I==0||(I-J)==0){C.fadeOut()}else{C.fadeIn()}},toggleBotMessages:function(){var I=f(".siropuChatRoom.siropuChatMessages > li.siropuChatBot");if(this.getMiscSetting("hide_bot")){I.fadeOut()}else{I.fadeIn()}},startRefreshInterval:function(){if(this.isVisible){if(this.options.active){this.refreshInterval=this.refreshActive}else{this.refreshInterval=this.refreshInactive}}else{if(this.options.active){this.refreshInterval=this.refreshActiveHidden}else{this.refreshInterval=this.refreshInactiveHidden}}this.refreshSet=setInterval(f.proxy(this,"refresh"),this.refreshInterval)},resetRefreshInterval:function(){this.stopRefreshInterval();var I=this;setTimeout(function(){I.startRefreshInterval()})},stopRefreshInterval:function(){clearInterval(this.refreshSet)},refresh:function(){var I=this;XF.ajax("GET",XF.canonicalizeUrl("index.php?chat/update"),{users:this.getUserList(),channel:this.channel,room_id:this.roomId,last_id:this.lastId,conv_id:this.convId,conv_unread:this.isVisible?this.convUnread:{},conv_only:this.convOnly,conv_items:this.getConvItems(),conv_last_active:this.convLastActive,conv_last_update:this.convLastUpdate,user_last_update:this.userLastUpdate,is_chat_page:i?1:0},function(J){I.updateRooms(J);I.updateConversations(J);I.updateNotice(J);I.updateActivityStatus(J);setTimeout(function(){I.doMessageActions(J)})},{skipDefault:true,skipError:true,global:false})},getUserList:function(){var I={};for(var J in this.activeUsers){I[J]=this.activeUsers[J].join(",")}return I},getConvItems:function(){return this.convItems.join(",")},adjustContentHeight:function(){var N=f(h).height();var I=D.height();var K=y.height();var M=B.height();var J=N-I;var L=20;if(f(".p-navSticky").length&&f(".p-navSticky.is-sticky").length){L+=f(".p-navSticky").height()}if(M){L+=M}if(f(".siropuChatAllPages.siropuChatMaximized").length){D.css("z-index",100);y.css("height",(K+J-L)+"px")}else{if(f("#siropuChatFullPage").length){y.css("height",(K+J)+"px")}}this.doAutoScroll()},adjustInputBox:function(){if(n.length&&f('html[dir="LTR"]').length){e.find(".fr-view").css("padding-right",n.outerWidth()+10)}},getFloodCheck:function(){if(this.bypassFloodCheck){return 0}if(this.inRoom()){return this.roomFloodCheck}else{return this.floodCheck}},editorFocus:function(){x.el.focus()},editorOn:function(){x.edit.on()},editorOff:function(){x.edit.off()},editorInsert:function(I){x.html.insert(I,true)},editorSetHtml:function(I){x.html.set(I);if(I){this.editorFocus()}},editorGetHtml:function(){return x.html.get(true)},editorGetText:function(){return f.trim(x.$el.text())},editorSetPlaceholder:function(J,I){var K=" ";switch(J){case"public":K=XF.phrase("siropu_chat_write_public_message");break;case"private":if(this.getConvCount()){K="("+I.data("username")+") "+XF.phrase("siropu_chat_write_private_message")}else{K=XF.phrase("siropu_chat_no_conversations_started")}break;case"posting":K=XF.phrase("siropu_chat_posting_message");break;case"wait":K=XF.phrase("siropu_chat_please_wait");break;case"readonly":K=XF.phrase("siropu_chat_room_is_read_only");break;case"noresponse":K=XF.phrase("siropu_chat_no_response");break;case"nopermission":K=XF.phrase("siropu_chat_do_not_have_permission_to_use");break}x.opts.placeholderText=K;x.placeholder.refresh()},editorOffPlaceholder:function(I){this.editorOff();this.editorSetPlaceholder(I)},editorOnPlaceholder:function(I){this.editorOn();this.editorSetPlaceholder(I)},loadSound:function(I){return this.sounds[I]?this.sounds[I]:new Audio(XF.config.url.basePath+"styles/default/siropu/chat/sounds/"+I+".mp3")},postLogout:function(){var I=this.getRoomCount();for(var J in this.lastId){this.leaveRoomPostActions(J,I!=0)}if(d.hasClass("siropuChatActiveTab")){this.getRooms()}else{if(!I){d.click()}}},setChannel:function(I){if(this.channel!=I){XF.Cookie.set("siropu_chat_channel",I);if(I=="room"){this.userUpdateInterval=30;this.convUpdateInterval=60}else{this.userUpdateInterval=60;this.convUpdateInterval=30}}this.channel=I},deleteOlderMessages:function(J,I){if(J-this.serverTime>=300&&I.find("> li[data-id]").length>=100&&I.data("autoscroll")==0){I.find(">li[data-id]:nth-child("+(this.inverse?"":"-")+"n+"+this.messageDisplayLimit+")").remove();this.serverTime=J}},_initRoomListActions:function(){var I=this;f(v).on("click",".siropuChatRoomInfo h3",function(){var J=f(this).parents("li");if(J.data("joined")){I.switchRoom(J.data("room-id"))}else{J.find(".siropuChatRoomJoin").submit()}});f(v).on("submit",".siropuChatRoomAction form",function(L){L.preventDefault();var K=f(this).find('button[type="submit"]');var J=f(this).find('input[name="password"]');if(J.length){J.toggle().focus();if(!J.val()){return}}K.prop("disabled",true);setTimeout(function(){K.prop("disabled",false);J.val("")},1000);XF.ajax("POST",f(this).attr("action"),{password:J.val(),users:I.getUserList()},function(M){if(M.action=="join"){I.loadRoom(M)}if(M.action=="leave"){I.leaveRoomPostActions(M.roomId)}I.getRooms()})})},_initRoomActions:function(){var I=this;f(v).on("click",".siropuChatRecipients",function(){var J=f(this).data("recipients").split(", ");I.editorSetHtml("/"+I.getCommand("whisper")+" ["+J.join(", ")+"] ")});f(v).on("click",".siropuChatTag, .siropuChatUserTag",function(J){var K=I.editorGetText();if(J.target.className.match("username")){J.preventDefault();var L=f(this).text()}else{var L=f(this).next("a").text()}I.editorInsert("@"+L+(K?"":", "))})},_initSubmitForm:function(){var I=this;o.on("editor:init",function(L,J){var K=o.data("buttons-remove");if(!XF.isEditorEnabled()&&K.match(/xfBbCode/)){XF.setIsEditorEnabled(true)}J.events.on("click",function(N){if(I.inConv()){var M=t.find('li[data-conv-id="'+I.convId+'"]');if(M.hasClass("siropuChatNewMessage")){M.removeClass("siropuChatNewMessage")}}});if(I.joinCommand){J.events.on("keyup",function(N){var P=I.editorGetText();var O=P.replace("/"+I.joinCommand,"").trim();if(P.match(/\/join/)&&O){var M=new XF.AutoCompleteResults({onInsert:function(Q){I.editorSetHtml(P.replace(O,Q));M.hideResults();c.submit()}});XF.ajax("GET",XF.canonicalizeUrl("index.php?chat/room/find"),{q:O},function(Q){M.showResults(Q.q,Q.results,c)},{global:false,error:false})}})}if(!I.canUseChat){I.editorOffPlaceholder("nopermission")}else{if(I.inRoom()&&F.find('a[data-room-id="'+I.roomId+'"]').data("readonly")){I.editorOffPlaceholder("readonly")}else{if(I.inRoom()&&!I.getRoomCount()||I.inConv()&&!I.getConvCount()){I.editorOffPlaceholder("")}}}if(i&&!I.inIframe&&!I.screenSizeIs("s")){XF.EditorHelpers.focus(x)}setTimeout(function(){I.adjustContentHeight();I.adjustInputBox()})});c.on("submit",function(N){N.preventDefault();var K=I.editorGetHtml();var M=I.editorGetText();if(!XF.isEditorEnabled()){var J=e.find('textarea[name="message"]').val();K=J;M=J}if(!M&&!f(K).find("img").length){return I.editorSetHtml("")}var O=f('.siropuChatMessages[data-room-id="'+I.roomId+'"]');var L=f('.siropuChatUsers[data-room-id="'+I.roomId+'"]');I.preSubmit();XF.ajax("POST",XF.canonicalizeUrl("index.php?chat/submit"),{users:I.getUserList(),channel:I.channel,room_id:I.roomId,last_id:I.lastId,conv_id:I.convId,conv_items:I.getConvItems(),conv_unread:I.convUnread,message_html:K},function(P){if(P.roomIdle){L.find('> li[data-user-id="'+I.userId+'"]').remove();I.removeUserFromActiveUsers(I.roomId,I.userId);if(!I.activeUsers[I.roomId].length){I.addNoRoomUsersMessage(L)}I.postSubmit();return}if(P.input){I.editorSetHtml(P.input)}if(P.roomTab){I.loadRoom(P);I.postSubmit();return}if(P.find!==undefined){f(".siropuChatMessages:visible").html(f(P.messages)).attr("data-search",P.find);I.doAutoScroll();I.postSubmit();return}if(P.leaveRoom){I.leaveRoomPostActions(P.leaveRoom,true)}if(P.leaveConv){I.leaveConversationPostActions(P)}if(P.logout){I.postLogout()}if(P.html){XF.setupHtmlInsert(P.html,function(Q,R){if(Q.length){XF.overlayMessage(R.title,Q)}})}if(P.prune){if(P.prune=="all"){f(".siropuChatMessages[data-room-id]").html("");I.lastId={}}else{if(P.prune=="room"){O.html("")}else{if(P.prune.user_id){O.find('> li[data-user-id="'+P.prune.user_id+'"]').remove()}else{if(P.prune.rows){if(I.inverse){O.find("> li").slice(0,Number(P.prune.rows)).remove()}else{O.find("> li").slice(Number(-P.prune.rows)).remove()}}}}}}if(P.sanctioned){L.find('> li[data-user-id="'+P.sanctioned+'"]').remove()}I.updateRooms(P);I.updateConversations(P);I.updateNotice(P);I.updateActivityStatus(P);if(I.getFloodCheck()){I.editorSetPlaceholder("wait")}setTimeout(function(){I.postSubmit()},I.getFloodCheck());if(I.inConv()){I.convLastActive=P.serverTime}},{global:false})})},_initTabs:function(){var I=this;F.on("click","a",function(L,J){L.preventDefault();f(this).removeClass("siropuChatNewMessage");y.find("> *").hide();F.find("a.siropuChatActiveTab").removeClass("siropuChatActiveTab");f(this).addClass("siropuChatActiveTab");I.editorSetPlaceholder("public");I.updateHeaderTitle(f(this));var K=f(this).data("target");switch(K){case"room":I.roomId=f(this).data("room-id");I.roomFloodCheck=f(this).data("flood-check");XF.Cookie.set("siropu_chat_room_id",I.roomId);y.find('[data-room-id="'+I.roomId+'"]').show();if(f(this).data("readonly")){I.editorOffPlaceholder("readonly")}else{I.editorOnPlaceholder("public")}if(I.isResponsive()){f(".siropuChatRoom.siropuChatUsers").hide()}else{if(!J){I.editorFocus()}}I.autoScroll();break;case"room-list":H.toggle();I.getRooms();I.editorOffPlaceholder("");break;case"conv-list":t.show();I.orderConversations();if(I.getConvCount()){t.find('li[data-conv-id="'+I.convId+'"]').trigger("click",true)}else{I.editorOffPlaceholder("")}break;case"conv-form":s.show();if(!I.screenSizeIs("s")){s.find("input").focus()}I.editorOffPlaceholder("");break}I.setChannel(K.match(/room/)?"room":"conv")})},_initConversations:function(){var I=this;t.on("click","li[data-conv-id]",function(K,J){I.convId=f(this).data("conv-id");XF.Cookie.set("siropu_chat_conv_id",I.convId);I.updateHeaderTitle(f(this));f(this).removeClass("siropuChatNewMessage");f(".siropuChatConversation.siropuChatMessages").hide();f(this).addClass("siropuChatActiveConversation").siblings().removeClass("siropuChatActiveConversation");var M=f('.siropuChatConversation.siropuChatMessages[data-conv-id="'+I.convId+'"]');if(M.find("> li").length){M.show();I.autoScroll(M);I.markCurrentConversationAsRead()}else{var L=f('<li class="siropuChatLoadingMessages" />');L.html(XF.phrase("siropu_chat_loading_conversation_messages"));M=I.createConversationMessageContainer(I.convId);M.html(L).insertBefore(s).show();I._initAutoScrollToggle(M);XF.ajax("POST",XF.canonicalizeUrl("index.php?chat/conversation/"+I.convId+"/load-messages"),{conv_unread:I.convUnread[I.convId]},function(N){M.html(N.messages);XF.activate(M);setTimeout(function(){I.doAutoScroll(M)})})}I.editorOn();I.editorSetPlaceholder("private",f(this));if(!I.inverse&&M.find("iframe").length){setTimeout(function(){I.autoScroll(M)},1000)}if(I.isResponsive()){if(J){M.hide()}else{t.hide()}}else{if(!J){I.editorFocus()}}});t.on("mouseover mouseout","> li",function(){f(this).find(".siropuChatConversationActions").toggle()})},_initOnLoad:function(){if(this.inverse){return}var I=this;f(".siropuChatMessages:visible .bbImage").on("load",function(){I.doAutoScroll()})},_initAutoScrollToggle:function(J){var I=this;var J=J?J:f(".siropuChatMessages");J.scroll(function(){I.toggleAutoScroll(f(this))})},_initSounds:function(){this.sounds.normal=this.getSoundSetting("normal")?this.loadSound("normal"):"";this.sounds.whisper=this.getSoundSetting("whisper")?this.loadSound("whisper"):"";this.sounds["private"]=this.getSoundSetting("private")?this.loadSound("private"):"";this.sounds.mention=this.getSoundSetting("mention")?this.loadSound("tag"):"";this.sounds.bot=this.getSoundSetting("bot")?this.loadSound("bot"):"";this.sounds.error=this.getSoundSetting("bot")?this.loadSound("error"):""},getChannel:function(){return this.channel},getRoomId:function(){return this.roomId},getConvId:function(){return this.convId},inRoom:function(){return this.channel=="room"},inConv:function(){return this.channel=="conv"},escapeRegExp:function(I){return isNaN(I)?I.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&"):I},addBarNewMessageClass:function(){if(m&&!this.isVisible){B.addClass("siropuChatNewMessage")}},removeUserFromActiveUsers:function(J,I){var K=this.activeUsers[J];this.activeUsers[J]=K.filter(function(L){return L!=I})},addNoRoomUsersMessage:function(I){I.html(f('<li class="siropuChatNoRoomUsers" />').html(XF.phrase("siropu_chat_no_one_is_chatting")))}});XF.SiropuChat.Form=XF.Element.newHandler({options:{edit:false,multiLine:false},init:function(){var J=this;var K=this.$target;var I=K.find("textarea");I.on("editor:init",function(M,L){L.opts.pastePlain=true;L.opts.multiLine=J.options.multiLine;L.opts.htmlAllowedTags=["img","a","table","tr","td","blockquote"];L.opts.heightMin=40;L.size.refresh();L.events.on("keydown",function(N){if(N.which==13){if(J.options.multiLine&&N.shiftKey){return N.preventDefault()}K.submit();if(J.options.edit){K.find(".js-overlayClose").click()}}});if(J.options.edit){setTimeout(function(){XF.EditorHelpers.focus(L)},500)}else{L.html.set("")}});f("#siropuChatEditor").on("keyup","textarea",function(L){if(L.which==13&&!XF.isEditorEnabled()&&!J.options.multiLine){K.submit()}})}});XF.SiropuChat.Messages=XF.Element.newHandler({options:{},init:function(){f('a[data-xf-click="siropu-chat-quote"]').remove();this.$target.on("mouseover mouseout",".siropuChatMessageRow",function(){if(f(this).find(".siropuChatMessageActions").length){f(this).find(".siropuChatDateTime, .siropuChatMessageActions").toggle()}})}});XF.SiropuChat.FindRooms=XF.Element.newHandler({options:{},init:function(){this.$target.on("keyup",function(){var J=f(this).val().trim();var I=new RegExp(J,"gi");f("#siropuChatRooms > li[data-room-name]").hide().each(function(){if(f(this).data("room-name").match(I)){f(this).show()}})})}});XF.SiropuChat.StartConversationForm=XF.Element.newHandler({options:{},init:function(){var I=this;this.$target.on("submit",function(L){L.preventDefault();var K=f(this).find("input");var J=f(this).find("textarea");if(!K.val().trim()){return K.focus()}if(!J.val().trim()){return J.focus()}XF.ajax("POST",f(this).attr("action"),f(this).serialize()+"&conv_items="+XF.SiropuChat.Core.prototype.getConvItems(),function(M){l=f("#siropuChatNoConversations");if(l.length){l.remove()}XF.SiropuChat.Core.prototype.updateConversations(M);F.find('a[data-target="conv-list"]').click();K.val("");J.val("")})})}});XF.SiropuChat.LeaveConversation=XF.Element.newHandler({options:{},init:function(){this.$target.on("ajax-submit:response",f.proxy(this,"ajaxResponse"))},ajaxResponse:function(J,I){XF.SiropuChat.Core.prototype.updateConversations(I);XF.SiropuChat.Core.prototype.leaveConversationPostActions(I)}});XF.SiropuChat.Like=XF.Click.newHandler({eventNameSpace:"SiropuChatLike",init:function(){},click:function(J){J.preventDefault();var I=this;XF.ajax("POST",this.$target.attr("href"),function(K){if(K.html){XF.setupHtmlInsert(K.html,function(L,M,N){if(L.length){I.$target.parents(".siropuChatMessageRow").replaceWith(L)}})}})}});XF.SiropuChat.Unlike=XF.Click.newHandler({eventNameSpace:"SiropuChatUnlike",init:function(){},click:function(J){J.preventDefault();var I=this;XF.ajax("POST",this.$target.attr("href"),function(K){if(K.html){XF.setupHtmlInsert(K.html,function(L,M,N){if(L.length){I.$target.parents(".siropuChatMessageRow").replaceWith(L)}})}})}});XF.SiropuChat.Quote=XF.Click.newHandler({eventNameSpace:"SiropuChatQuote",init:function(){},click:function(I){I.preventDefault();XF.ajax("POST",this.$target.attr("href"),function(J){if(J.quote){XF.SiropuChat.Core.prototype.editorSetHtml(J.quote)}})}});XF.SiropuChat.LeaveRoom=XF.Click.newHandler({eventNameSpace:"SiropuChatLeaveRoom",init:function(){},click:function(J){J.preventDefault();var I=this;XF.ajax("POST",this.$target.attr("href"),function(K){XF.SiropuChat.Core.prototype.leaveRoomPostActions(K.roomId,true);I.$target.parent(".menu").toggle()})}});XF.SiropuChat.Whisper=XF.Click.newHandler({eventNameSpace:"SiropuChatWhisper",options:{username:""},init:function(){},click:function(P){var R=this.$target.parents(".menu").attr("id");var K=XF.SiropuChat.Core.prototype.editorGetText();var L=XF.SiropuChat.Core.prototype.getCommand("whisper");var I=[];I.push(this.options.username);if(K.match(/\[(.*?)\]/)){var S=K.indexOf("[");var M=K.indexOf("]");var O=K.substring(S+1,M);if(O.length){var Q=O.split(",");for(var N in Q){I.push(Q[N].trim())}}if(O.match(XF.SiropuChat.Core.prototype.escapeRegExp(this.options.username))){I=I.filter(function(T){return T!=this.options.username})}}var J="";if(I.length){J="/"+L+" ["+I.join(", ")+"] "}XF.SiropuChat.Core.prototype.editorSetHtml(J)}});XF.SiropuChat.LoadMoreMessages=XF.Click.newHandler({eventNameSpace:"siropuChatLoadMoreMessages",init:function(){},click:function(L){L.preventDefault();var M=this.$target;if(M.data("complete")){return}var N=M.parents("ul.siropuChatMessages");var J=N.data("room-id");var O=N.data("conv-id");var Q=N.attr("data-search");var K=XF.SiropuChat.Core.prototype.getMiscSetting("inverse");if(K){var P=N.find("> li[data-id]:last")}else{var P=N.find("> li[data-id]:first")}if(J){var I="room/"+J}else{var I="conversation/"+O}XF.ajax("GET",XF.canonicalizeUrl("index.php?chat/"+I+"/load-more-messages"),{message_id:P.data("id"),find:Q},function(R){if(R.messages){if(K){P.after(R.messages)}else{P.before(R.messages).get(0).scrollIntoView({behavior:"smooth",block:"nearest",inline:"start"})}XF.activate(P.parent())}if(!R.hasMore){M.attr("data-complete",true);M.html(XF.phrase("siropu_chat_all_messages_have_been_loaded"));setTimeout(function(){M.fadeOut()},5000)}})}});XF.SiropuChat.EditNotice=XF.Element.newHandler({options:{},init:function(){this.$target.on("ajax-submit:response",f.proxy(this,"ajaxResponse"))},ajaxResponse:function(J,I){if(I.message){XF.flashMessage(I.message,2000)}XF.SiropuChat.Core.prototype.updateNotice(I)}});XF.SiropuChat.ToggleUsers=XF.Click.newHandler({eventNameSpace:"siropuChatToggleUsers",init:function(){},click:function(K){var J=XF.SiropuChat.Core.prototype.getChannel();var I=XF.SiropuChat.Core.prototype.getRoomId();var L=XF.SiropuChat.Core.prototype.getConvId();if(J=="room"){f('.siropuChatUsers[data-room-id="'+I+'"]').toggle();f('.siropuChatMessages[data-room-id="'+I+'"]').toggle()}else{t.toggle();f('.siropuChatMessages[data-conv-id="'+L+'"]').toggle()}}});XF.SiropuChat.ToggleOptions=XF.Click.newHandler({eventNameSpace:"siropuChatToggleOptions",init:function(){},click:function(J){var I=this.$target.parents("fieldset").find("input");I.prop("checked",I.filter(":checked").length?false:true);E.change()}});XF.SiropuChat.ToggleConvForm=XF.Click.newHandler({eventNameSpace:"siropuChatToggleConvForm",init:function(){},click:function(J){var I=this.$target.parent(".siropuChatUserMenu").find("form");I.toggle();if(!XF.SiropuChat.Core.prototype.screenSizeIs("s")){I.find("textarea").focus()}}});XF.SiropuChat.ResetColor=XF.Click.newHandler({eventNameSpace:"SiropuChatResetColor",init:function(){},click:function(J){var I=E.find(".colorPickerBox");I.removeClass("is-active");I.find(".colorPickerBox-sample").attr("style","");E.find('input[name="message_color"]').val("");E.trigger("change")}});XF.SiropuChat.Logout=XF.Element.newHandler({options:{},init:function(){this.$target.on("ajax-submit:response",f.proxy(this,"ajaxResponse"))},ajaxResponse:function(J,I){if(I.errors||I.exception){return}J.preventDefault();if(I.message){XF.flashMessage(I.message,3000)}XF.SiropuChat.Core.prototype.postLogout()}});XF.SiropuChat.TextSelect=XF.Element.newHandler({options:{},init:function(){var I=this;setTimeout(function(){I.$target.select().focus()},500)}});XF.SiropuChat.EditorButton={init:function(){XF.SiropuChat.EditorButton.initializeDialog();XF.EditorHelpers.dialogs.chat=new XF.SiropuChat.EditorDialogGallery("chat");if(f.FE.COMMANDS.xfCustom_chat){f.FE.COMMANDS.xfCustom_chat.callback=XF.SiropuChat.EditorButton.callback}},initializeDialog:function(){XF.SiropuChat.EditorDialogGallery=XF.extend(XF.EditorDialog,{cache:false,_init:function(L){var K=this;var J=L.$container;var I=J.find(".formSubmitRow-controls");f(".siropuChatDialogInsert").click(function(M){M.preventDefault();f(".js-attachmentFileSelected").each(function(){K.ed.image.insert(f(this).data("url"))});K.overlay.hide()});f(".siropuChatDialogDelete").click(function(N){N.preventDefault();var M=[];f(".js-attachmentFileSelected").each(function(){M.push(f(this).data("attachment-id"))});if(M.length){XF.ajax("POST",XF.canonicalizeUrl("index.php?chat/delete-attachments"),{hash:J.find('input[name="hash"]').val(),remove:M,},function(O){if(O.success){f(".js-attachmentFileSelected").remove();if(!J.find(".js-attachmentFile").length){I.fadeOut()}}})}});J.on("click",".js-attachmentFile",function(){f(this).toggleClass("js-attachmentFileSelected");if(J.find(".js-attachmentFileSelected").length){I.fadeIn()}else{I.fadeOut()}})}})},callback:function(){XF.EditorHelpers.loadDialog(this,"chat")}};f(v).on("editor:first-start",XF.SiropuChat.EditorButton.init);XF.Element.register("siropu-chat","XF.SiropuChat.Core");XF.Element.register("siropu-chat-form","XF.SiropuChat.Form");XF.Element.register("siropu-chat-messages","XF.SiropuChat.Messages");XF.Element.register("siropu-chat-find-rooms","XF.SiropuChat.FindRooms");XF.Element.register("siropu-chat-start-conversation-form","XF.SiropuChat.StartConversationForm");XF.Element.register("siropu-chat-leave-conversation","XF.SiropuChat.LeaveConversation");XF.Element.register("siropu-chat-edit-notice","XF.SiropuChat.EditNotice");XF.Element.register("siropu-chat-logout","XF.SiropuChat.Logout");XF.Element.register("siropu-chat-text-select","XF.SiropuChat.TextSelect");XF.Click.register("siropu-chat-like","XF.SiropuChat.Like");XF.Click.register("siropu-chat-unlike","XF.SiropuChat.Unlike");XF.Click.register("siropu-chat-quote","XF.SiropuChat.Quote");XF.Click.register("siropu-chat-whisper","XF.SiropuChat.Whisper");XF.Click.register("siropu-chat-leave-room","XF.SiropuChat.LeaveRoom");XF.Click.register("siropu-chat-load-more-messages","XF.SiropuChat.LoadMoreMessages");XF.Click.register("siropu-chat-toggle-users","XF.SiropuChat.ToggleUsers");XF.Click.register("siropu-chat-toggle-options","XF.SiropuChat.ToggleOptions");XF.Click.register("siropu-chat-toggle-conv-form","XF.SiropuChat.ToggleConvForm");XF.Click.register("siropu-chat-reset-color","XF.SiropuChat.ResetColor")}(jQuery,window,document);